# style-example-qt5
qt5 style的例子

## 纯色判断
这个例子是一个实验性的例子，探究如何有效并且较为迅速的判断一个图片是否为纯色。

## 思路
### 通过RGB判断
> 给定一个容忍区域，当有不同颜色超过这个区域时，判断为不是纯色。

> 这样做的优点在于非常的快速，只需要对每个点进行最多一次计算就能得到结果，缺点是对于容忍区域的界定很难，而且对于一些肉眼看上去是纯色的图标没办法判断为纯色。

目前的主题框架高亮协议就是使用这种笼统的方式进行判断的，所以经常出问题，这一块还有改进的空间。

### 图像梯度
> 通过计算颜色的变化得到一个梯度图，规定一个阈值，当所有变化值均小于阈值时，判断为纯色。

> 梯度是一个开阔眼界的思路，然而在这里不太适用，首先我们计算图像梯度的代价太大了，这不适合用在主题当中，另外我们的图片大部分是有alpha通道的，一些地方的颜色会产生跳变，这些点也难以排除。

### HSV颜色空间与区域分析
> 我们使用设计师常用的色调、饱和度&亮度（HSV）取代之前的rgb颜色空间，然后生成一个直方图（透明点阵不计），通过观察和计算这个直方图的数据可以判断一个图片是否为纯色。

> 直方图利于我们观测图标颜色的分布情况，我们实际上需要通过计算标准差的形式得到一个可以量化的标准，图片的颜色越纯，得到的标准差越小。

> 这种方式看似没有漏洞，然而我们知道饱和度和亮度同样会影响我们对颜色的观测，实际情况下我们并不知道一个灰暗的图片的某一点的色调是否会有很大的不同（事实上在图片压缩之后，某些位置的色调会发生很大变化），综合考虑这些因素，我们很难顾全种种情况

## 实践
虽然HSV颜色空间是理想状态下的最佳选择，但是实际上我也指出了上面的一下现实的问题，想要判断颜色的接近程度，我们还是得从rgb这种较为独立和精确的颜色空间进行判断。

我们将某一点的颜色模拟成一个RGB三维空间的一个点（或者一个向量），一张图片点的密集程度决定了它的纯度，我们需要计算三维空间上的标准差实现标准的量化。

与思路一类似的，对于有透明度的颜色，我们可能需要做更加细致的处理，可以加一个权重值，以增加精确程度并且减小整体误差。

我们使用Qt Data Visualization(libqt5datavisualization5-dev)的api绘制一个三维图表，同时使用c++的矩阵运算库eigen计算出三维向量组的标准差。

通过这个例子，我们可以以三维图像加量化值的方式直接看到图像颜色的离散程度。这里我们取一个阈值0.2,作为判断的基准，当标准差小于0.2时，则认为图像是纯色的。虽然不能说这种方式能够完全准确的判断一个图片是否为纯色，但是这种方式的准确性和可靠性应该是高于第一种的，计算标准差的运算相较于求梯度也小了很多。